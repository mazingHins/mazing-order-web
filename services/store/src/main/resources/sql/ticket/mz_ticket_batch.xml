<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- 这里namespace必须是接口的路径，不然要运行的时候要报错 “is not known to the MapperRegistry” -->
<mapper namespace="com.mazing.services.store.ticket.dao.TicketBatchDao">

	<!-- 新增 -->
	<insert id="save"
		parameterType="com.mazing.services.store.ticket.entry.TicketBatchPO"
		useGeneratedKeys="true" keyProperty="batchNo">
		insert into mz_merchant.mz_ticket_batch
		(batch_no,ticket_rule_id,create_total,create_time,admin_id,check_total)
		values
		(#{batchNo},#{ticketRuleId},#{createTotal},#{createTime},#{adminId},#{checkTotal})
	</insert>

	<!-- 根据主键，删除数据 <delete id="deleteById" parameterType="Map"> DELETE FROM 
		mz_merchant.mz_ticket_batch WHERE batch_no=#{param1} </delete> -->

	<!-- 更新 -->
	<update id="update"
		parameterType="com.mazing.services.store.ticket.entry.TicketBatchPO">
		update mz_merchant.mz_ticket_batch set
		ticket_rule_id=#{ticketRuleId},create_total=#{createTotal},admin_id=#{adminId},check_total=#{checkTotal}
		where batch_no=#{batchNo}
	</update>

	<!-- 根据主键读取记录（主键可能有多个） -->
	<select id="getById" parameterType="Map"
		resultType="com.mazing.services.store.ticket.entry.TicketBatchPO">
		SELECT * FROM mz_merchant.mz_ticket_batch WHERE
		batch_no=#{param1}
	</select>

	<!-- 查询全部记录 -->
	<select id="listAll"
		resultType="com.mazing.services.store.ticket.entry.TicketBatchPO">
		SELECT * FROM mz_merchant.mz_ticket_batch
	</select>

	<select id="listByTicketRuleId"
		resultType="com.mazing.services.store.ticket.entry.TicketBatchPO">
		SELECT * FROM mz_merchant.mz_ticket_batch where
		ticket_rule_id=#{ticketRuleId} order by create_time desc
	</select>
	
	<!-- 更新 某一批次的使用总数 -->
	<update id="updateUseTotalById" parameterType="Map" >
		update mz_merchant.mz_ticket_batch set check_total= check_total + #{amount} WHERE batch_no=#{batchNo}
	</update>

</mapper>
