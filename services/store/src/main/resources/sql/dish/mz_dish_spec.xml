<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- 这里namespace必须是接口的路径，不然要运行的时候要报错 “is not known to the MapperRegistry” -->
<mapper namespace="com.mazing.services.store.dish.dao.DishSpecDao">

	<!-- 新增 -->
	<insert id="save" parameterType="com.mazing.services.store.dish.entry.DishSpecPO" useGeneratedKeys="false" >
		insert into mz_merchant.mz_dish_spec (spec_id,spec_key,dish_key,store_id,spec_name,currency_type,price,original_price,daily_num,supplement_label,max_supplement,min_supplement,create_time) values (#{specId},#{specKey},#{dishKey},#{storeId},#{specName},#{currencyType},#{price},#{originalPrice},#{dailyNum},#{supplementLabel},#{maxSupplement},#{minSupplement},#{createTime})
	</insert>

	<!-- 根据主键，删除数据 -->
	<delete id="deleteById" parameterType="Map">
		DELETE FROM mz_merchant.mz_dish_spec WHERE spec_id=#{param1}
	</delete>

	<!-- 更新 -->
	<update id="update" parameterType="com.mazing.services.store.dish.entry.DishSpecPO">
		update mz_merchant.mz_dish_spec set spec_key=#{specKey},dish_key=#{dishKey},store_id=#{storeId},spec_name=#{specName},currency_type=#{currencyType},price=#{price},original_price=#{originalPrice},daily_num=#{dailyNum},supplement_label=#{supplementLabel},max_supplement=#{maxSupplement},min_supplement=#{minSupplement} where spec_id=#{specId}
	</update>

	<!-- 根据主键读取记录（主键可能有多个） -->
	<select id="getById" parameterType="Map" resultType="com.mazing.services.store.dish.entry.DishSpecPO">
		SELECT * FROM mz_merchant.mz_dish_spec WHERE spec_id=#{specId}
	</select>

	<!-- 根据specKey读取记录 -->
	<select id="getByKey" parameterType="Map" resultType="com.mazing.services.store.dish.entry.DishSpecPO">
		SELECT * FROM mz_merchant.mz_dish_spec WHERE spec_key=#{specKey}
	</select>
	
	<!-- 根据specKey读取记录, 支持多个key -->
	<select id="getByKeys" parameterType="Map" resultType="com.mazing.services.store.dish.entry.DishSpecPO">
		SELECT * FROM mz_merchant.mz_dish_spec WHERE spec_key in (
			<foreach collection="specKeys" item="item" index="index" separator="," >
				#{item}
			</foreach>
		) ORDER BY spec_key ASC
	</select>

	<!-- 查询指定美食的全部规格记录 -->
	<select id="listByDishKey" resultType="com.mazing.services.store.dish.entry.DishSpecPO">
		SELECT * FROM mz_merchant.mz_dish_spec WHERE dish_key=#{dishKey} ORDER BY spec_key ASC
	</select>

	<!-- 查询指定餐厅的下全部美食的 全部规格记录 -->
	<select id="listByStoreId" resultType="com.mazing.services.store.dish.entry.DishSpecPO">
		SELECT * FROM mz_merchant.mz_dish_spec WHERE store_id=#{storeId} ORDER BY spec_key ASC
	</select>
	
	<!-- 获取菜品的默认规格 -->
	<select id="getDishDefaultSpec" parameterType="Map" resultType="com.mazing.services.store.dish.entry.DishSpecPO">
		SELECT * FROM mz_merchant.mz_dish_spec WHERE dish_key=#{dishKey} ORDER BY price ASC, spec_key ASC limit 0,1
	</select>

	<!-- 根据菜品Key, 删除不在规格id list的备注(选填) -->
	<delete id="deleteByDishKeyAndInIdList" parameterType="Map"> 
		DELETE FROM mz_merchant.mz_dish_spec WHERE dish_key=#{dishKey}  
		<if test="specIds != null">
			AND spec_id IN (
			<foreach collection="specIds" item="item" index="index" separator="," >
				#{item}
			</foreach>
		)
		</if>
	</delete>
</mapper>
