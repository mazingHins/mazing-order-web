<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- 这里namespace必须是接口的路径，不然要运行的时候要报错 “is not known to the MapperRegistry” -->
<mapper namespace="com.mazing.services.store.dish.dao.DishPicDao">

	<!-- 新增 -->
	<insert id="save" parameterType="com.mazing.services.store.dish.entry.DishPicPO" useGeneratedKeys="false" >
		insert into mz_merchant.mz_dish_pic (pic_id,dish_key,path,content,effective,sequence,create_time) values (#{picId},#{dishKey},#{path},#{content},#{effective},#{sequence},#{createTime})
	</insert>

	<!-- 根据主键读取记录（主键可能有多个） -->
	<select id="getById" parameterType="Map" resultType="com.mazing.services.store.dish.entry.DishPicPO">
		SELECT * FROM mz_merchant.mz_dish_pic WHERE pic_id=#{picId}
	</select>

	<!-- 查询菜品下的全部图片 -->
	<select id="queryByDishKey" resultType="com.mazing.services.store.dish.entry.DishPicPO">
		SELECT * FROM mz_merchant.mz_dish_pic WHERE dish_key = #{dishKey}
		<if test="1 == situation">AND effective = 1</if>
		<if test="0 == situation">AND effective = 0</if>
		ORDER BY sequence ASC
	</select>
	
	<!-- 批量更新图片序号 -->
	<update id="batchUpdatePicSequence" parameterType="list">
		update mz_merchant.mz_dish_pic
		<trim prefix="set" suffix="end">
			<trim prefix="sequence = case pic_id" suffix="">
				<foreach collection="list" item="i" index="index">
                    <if test="i.sequence!=null">
                          when #{i.picId} then #{i.sequence}
                    </if>
            	</foreach>
            </trim>
		</trim>
		, effective = 1
		where
		<foreach collection="list" separator="or" item="i" index="index" >
              pic_Id=#{i.picId}
        </foreach>
	</update>
	
	<!-- 批量更新图片状态 -->
	<update id="batchUpdateStatus" parameterType="Map">
		update mz_merchant.mz_dish_pic set effective = #{effectivity}
		where pic_id in
		<foreach item="item" index="index" collection="ids" open="(" separator="," close=")">  
 			#{item}
		</foreach>
	</update>

</mapper>
