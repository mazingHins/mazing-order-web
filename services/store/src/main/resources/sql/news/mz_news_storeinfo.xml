<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- 这里namespace必须是接口的路径，不然要运行的时候要报错 “is not known to the MapperRegistry” -->
<mapper namespace="com.mazing.services.store.news.dao.NewsStoreinfoDao">

	<!-- 新增 -->
	<insert id="save"
		parameterType="com.mazing.services.store.news.entry.NewsStoreinfoPO"
		useGeneratedKeys="false">
		insert into mz_merchant.mz_news_storeinfo
		(sinfo_id,store_id,store_name,show_imgs,thumb_img,taste,env,cost_effective,reviews,reviewer,want,eaten,in_mazing,map_img,address,phone,per_consume,open_hours,lat,lng,create_time,update_time,rec_dishs,show_mazing_pay,show_online_store)
		values
		(#{sinfoId},#{storeId},#{storeName},#{showImgs},#{thumbImg},#{taste},#{env},#{costEffective},#{reviews},#{reviewer},#{want},#{eaten},#{inMazing},#{mapImg},#{address},#{phone},#{perConsume},#{openHours},#{lat},#{lng},#{createTime},#{updateTime},#{recDishs},#{showMazingPay},#{showOnlineStore})
	</insert>

	<!-- 根据主键，删除数据 -->
	<delete id="deleteById" parameterType="Map">
		DELETE FROM
		mz_merchant.mz_news_storeinfo WHERE sinfo_id=#{param1}
	</delete>


	<!-- 更新 -->
	<update id="update"
		parameterType="com.mazing.services.store.news.entry.NewsStoreinfoPO">
		update mz_merchant.mz_news_storeinfo set
		store_id=#{storeId},store_name=#{storeName},show_imgs=#{showImgs},thumb_img=#{thumbImg},taste=#{taste},env=#{env},cost_effective=#{costEffective},reviews=#{reviews},reviewer=#{reviewer},want=#{want},eaten=#{eaten},in_mazing=#{inMazing},map_img=#{mapImg},address=#{address},phone=#{phone},per_consume=#{perConsume},open_hours=#{openHours},lat=#{lat},lng=#{lng},update_time=#{updateTime},rec_dishs=#{recDishs},show_mazing_pay=#{showMazingPay},show_online_store=#{showOnlineStore}
		where sinfo_id=#{sinfoId}
	</update>

	<!-- 根据主键读取记录（主键可能有多个） -->
	<select id="getById" parameterType="Map"
		resultType="com.mazing.services.store.news.entry.NewsStoreinfoPO">
		SELECT * FROM mz_merchant.mz_news_storeinfo WHERE
		sinfo_id=#{param1}
	</select>
	
	<select id="listByStoreId" parameterType="Map"
		resultType="com.mazing.services.store.news.entry.NewsStoreinfoPO">
		SELECT * FROM mz_merchant.mz_news_storeinfo WHERE
		store_id=#{param1} order by create_time DESC
	</select>
	

	<!-- 查询 想吃/吃过 数 -->
	<select id="getFavCount" parameterType="Map" resultType="java.lang.Integer">
		SELECT
		<if test="type==1">
			want
		</if>
		<if test="type==2">
			eaten
		</if>
		FROM mz_merchant.mz_news_storeinfo WHERE sinfo_id=#{sinfoId}
	</select>


	<!-- 查询全部记录 -->
	<select id="listAll"
		resultType="com.mazing.services.store.news.entry.NewsStoreinfoPO">
		SELECT * FROM mz_merchant.mz_news_storeinfo
	</select>

	<select id="pageAll"
		resultType="com.mazing.services.store.news.entry.NewsStoreinfoPO">
		SELECT * FROM mz_merchant.mz_news_storeinfo ORDER BY
		create_time DESC LIMIT #{offset}, #{rows}
	</select>


	<!--  想吃/吃过 的人数+1  -->
	<update id="increaseWantOrEaten" parameterType="Map">
		UPDATE mz_merchant.mz_news_storeinfo set

		<if test="type==1">
			want=want+1
		</if>
		<if test="type==2">
			eaten=eaten+1
		</if>
		where sinfo_id=#{sinfoId}
	</update>
	
	<!--  想吃/吃过 的人数 -1 -->
	<update id="decreaseWantOrEaten" parameterType="Map">
		UPDATE mz_merchant.mz_news_storeinfo set

		<if test="type==1">
			want=want-1
		</if>
		<if test="type==2">
			eaten=eaten-1
		</if>
		where sinfo_id=#{sinfoId}
	</update>

	<!-- 更新show_mazing_pay 状态 -->
	<update id="updateShowMazingPayStatus" parameterType="Map">
		UPDATE mz_merchant.mz_news_storeinfo set

		show_mazing_pay=#{status} where sinfo_id=#{sinfoId}
		
	</update>
	


</mapper>
