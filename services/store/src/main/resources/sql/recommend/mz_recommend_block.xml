<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- 这里namespace必须是接口的路径，不然要运行的时候要报错 “is not known to the MapperRegistry” -->
<mapper namespace="com.mazing.services.store.recommend.dao.RecommendBlockDao">

	<!-- 新增 -->
	<insert id="save" parameterType="com.mazing.services.store.recommend.entry.RecommendBlockPO" useGeneratedKeys="false">
		insert into mz_merchant.mz_recommend_block
		(bid,city_code,lang_code,title,type,auto_push,auto_sorting,active_start_minute,active_end_minute,active_login_status,action,url,can_share,action_params,share_img,share_title,share_content,status,sequence,create_time,modify_time,admin_id)
		values
		(#{bid},#{cityCode},#{langCode},#{title},#{type},#{autoPush},#{autoSorting},#{activeStartMinute},#{activeEndMinute},#{activeLoginStatus},#{action},#{url},#{canShare},#{actionParams},#{shareImg},#{shareTitle},#{shareContent},#{status},#{sequence},#{createTime},#{modifyTime},#{adminId})
	</insert>

	<!-- 根据主键，删除数据 -->
	<delete id="deleteById" parameterType="Map">
		DELETE FROM mz_merchant.mz_recommend_block WHERE bid=#{bid}
	</delete>

	<!-- 更新 -->
	<update id="update" parameterType="com.mazing.services.store.recommend.entry.RecommendBlockPO">
		update mz_merchant.mz_recommend_block set
		city_code=#{cityCode},lang_code=#{langCode},title=#{title},type=#{type},auto_push=#{autoPush},auto_sorting=#{autoSorting},active_start_minute=#{activeStartMinute},active_end_minute=#{activeEndMinute},active_login_status=#{activeLoginStatus},action=#{action},url=#{url},can_share=#{canShare},action_params=#{actionParams},share_img=#{shareImg},share_title=#{shareTitle},share_content=#{shareContent},status=#{status},sequence=#{sequence},modify_time=#{modifyTime},admin_id=#{adminId}
		where bid=#{bid}
	</update>

	<!-- 根据主键读取记录（主键可能有多个） -->
	<select id="getById" parameterType="Map" resultType="com.mazing.services.store.recommend.entry.RecommendBlockPO">
		SELECT * FROM mz_merchant.mz_recommend_block WHERE bid=#{param1}
	</select>

	<!-- 根据cityCode\langCode 获取推荐的块数据列表, sequence 由小到大排序 -->
	<select id="listByCityLang" parameterType="Map" resultType="com.mazing.services.store.recommend.entry.RecommendBlockPO">
		SELECT * FROM mz_merchant.mz_recommend_block where city_code=#{cityCode} AND lang_code=#{langCode} order by sequence ASC
	</select>

	<!-- 根据cityCode 和 status 查询全部记录 -->
	<select id="listAllByStatus" parameterType="Map" resultType="com.mazing.services.store.recommend.entry.RecommendBlockPO">
		SELECT * FROM mz_merchant.mz_recommend_block where city_code=#{cityCode} AND lang_code=#{langCode} AND status=#{status} order by sequence ASC
	</select>

	<!-- 更新块 的状态 -->
	<update id="updateBlockStatus" parameterType="Map">
		update mz_merchant.mz_recommend_block set status=#{newStatus},admin_id=#{adminId}, modify_time=now() where bid=#{bid} AND status=#{oldStatus}
	</update>

	<!-- 删除指定的数据 -->
	<delete id="deleteAllByCityLang" parameterType="Map">
		DELETE FROM mz_merchant.mz_recommend_block WHERE city_code=#{cityCode} AND lang_code=#{langCode}
	</delete>

	<!-- 更新块 的 标题 -->
	<update id="updateBlockTitle" parameterType="Map">
		update mz_merchant.mz_recommend_block set title=#{title},admin_id=#{adminId}, modify_time=now() where bid=#{bid}
	</update>
	<!-- 更新块 的 排序号 -->
	<update id="updateBlockSequence" parameterType="Map">
		update mz_merchant.mz_recommend_block set sequence=#{sequence}, admin_id=#{adminId}, modify_time=now() where bid=#{bid}
	</update>

	<!-- 更新块 的 排序号 , 乐观锁 -->
	<update id="updateBlockSequenceById" parameterType="Map">
		update mz_merchant.mz_recommend_block set sequence=#{newSequence}, admin_id=#{adminId}, modify_time=now() where bid=#{bid} AND sequence=#{oldSequence}
	</update>

	<!-- 获取sequence 最大的那条记录 -->
	<select id="getMaxSequenceBlock" parameterType="Map" resultType="com.mazing.services.store.recommend.entry.RecommendBlockPO">
		SELECT * FROM mz_merchant.mz_recommend_block where city_code=#{cityCode} order by sequence DESC limit 1
	</select>

	<!-- 获取cityCode下 sequence小于给定的sequence的记录， sequence 由小到大排序 -->
	<select id="getLittlerThanSequenceBlocks" parameterType="Map" resultType="com.mazing.services.store.recommend.entry.RecommendBlockPO">
		<![CDATA[ 
		SELECT * FROM mz_merchant.mz_recommend_block where city_code=#{cityCode} AND sequence < #{sequence} order by sequence ASC
		]]>
	</select>

	<!-- 获取cityCode下 sequence大于给定的sequence的记录, sequence 倒排序 -->
	<select id="getLargeThanSequenceBlocks" parameterType="Map" resultType="com.mazing.services.store.recommend.entry.RecommendBlockPO">
		SELECT * FROM mz_merchant.mz_recommend_block where
		city_code=#{cityCode} 
		<![CDATA[ 
				AND sequence>#{sequence}
		]]>
		order by sequence DESC
	</select>

	<!-- 获取排序在指定sequence 前面的一条记录 -->
	<select id="getFrontBlock" parameterType="Map" resultType="com.mazing.services.store.recommend.entry.RecommendBlockPO">
		SELECT * FROM mz_merchant.mz_recommend_block where
		city_code=#{cityCode} 
		<![CDATA[ 
				AND sequence<#{sequence}
		]]>
		order by sequence DESC limit 1
	</select>

	<!-- 获取排序在指定sequence 后面的一条记录 -->
	<select id="getBehindBlock" parameterType="Map" resultType="com.mazing.services.store.recommend.entry.RecommendBlockPO">
		SELECT * FROM mz_merchant.mz_recommend_block where
		city_code=#{cityCode} 
		<![CDATA[ 
				AND sequence>#{sequence}
		]]>
		order by sequence ASC limit 1
	</select>

</mapper>
