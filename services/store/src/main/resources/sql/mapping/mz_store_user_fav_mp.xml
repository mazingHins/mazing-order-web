<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- 这里namespace必须是接口的路径，不然要运行的时候要报错 “is not known to the MapperRegistry” -->
<mapper namespace="com.mazing.services.store.mapping.dao.StoreUserFavMpDao">

	<!-- 新增 -->
	<insert id="save" parameterType="com.mazing.services.store.mapping.entry.StoreUserFavMpPO" useGeneratedKeys="false" >
		insert into mz_merchant.mz_store_user_fav_mp (uid,store_id,create_time) values (#{uid},#{storeId},#{createTime})
	</insert>

	<!-- 删除指定的数据 -->
	<delete id="deleteById">
		DELETE FROM mz_merchant.mz_store_user_fav_mp WHERE uid = #{uid} AND store_id IN (
			<foreach collection="storeIds" item="item" index="index" separator="," >#{item,jdbcType=BIGINT}</foreach>
		)
	</delete>

	<!-- 根据主键读取记录（主键可能有多个） -->
	<select id="getById" parameterType="Map" resultType="com.mazing.services.store.mapping.entry.StoreUserFavMpPO">
		SELECT * FROM mz_merchant.mz_store_user_fav_mp WHERE store_id=#{storeId} AND uid=#{uid}
	</select>

	<!-- 获取用户喜欢列表（分页|不分页） -->
	<select id="listMyFavByPage" resultType="com.mazing.services.store.mapping.entry.StoreUserFavMpPO">
		SELECT * FROM mz_merchant.mz_store_user_fav_mp where uid = #{uid} ORDER BY create_time DESC
		<if test="null != rows">
			LIMIT <if test="null != offset">#{offset},</if>#{rows}
		</if>
	</select>
	
	<!-- 获取在指定的餐厅id中，我喜欢的列表  -->
	<select id="listMyFav" resultType="com.mazing.services.store.mapping.entry.StoreUserFavMpPO">
		SELECT * FROM mz_merchant.mz_store_user_fav_mp where uid = #{uid} 
		AND store_id IN (
		<foreach collection="storeIds" item="item" index="index" separator="," >
			#{item}
		</foreach>
		) 
	</select>

	<!--
	统计餐厅收藏排行榜 2016/2/29 by ten
	-->
	<select id="statStoreFavRank" resultType="Map">
		select
			a.store_id as storeId, a.store_name as storeName, b.num
		from
			mz_merchant.mz_store a
		inner join
			(select store_id, count(*) num from mz_merchant.mz_store_user_fav_mp group by store_id) b
		on
			a.store_id=b.store_id
		order by b.num desc limit 100;
	</select>
</mapper>
